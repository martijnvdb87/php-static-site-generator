<?php
require __DIR__ . '/vendor/autoload.php';

use Martijnvdb\StaticSiteGenerator\File;
use Martijnvdb\StaticSiteGenerator\Html;
use Martijnvdb\StaticSiteGenerator\Api;
use Martijnvdb\StaticSiteGenerator\Config;
use Martijnvdb\PhpCli\Cli;
use Martijnvdb\PhpCli\Input;
use Martijnvdb\PhpCli\Progress;

$cli = (new Cli('Static site generator', '0.1.0'))
    ->add(function ($input, $output) {
        $config = Config::create();

        if(is_null($config->get('url'))) {
            $url_value = Input::text('[yellow]Site url[/yellow]:')
                ->required()
                ->get();
            
            $config->set('url', $url_value);
        }

        $config->build();

        $GLOBALS['progress_current'] = 0;

        $GLOBALS['progress'] = Progress::new();
        $GLOBALS['progress']->start();
        
        File::resetPublicDir();

        Html::create()->build();

        $GLOBALS['progress']->set(0.75);
        
        Api::create()->build();
        
        $GLOBALS['progress']->set(1);
        $GLOBALS['progress']->stop();
    })
    ->run();
